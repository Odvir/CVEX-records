---
- name: Install LDAP server and payload web server
  hosts: all
  become: yes
  tasks:
    - name: Update apt package index
      apt:
        update_cache: yes
        
    - name: Install a list of packages
      ansible.builtin.apt:
        pkg:
        - python3-pip
        
    - name: Create /opt/log4j-shell-poc
      file:
        path: /opt/log4j-shell-poc
        state: directory

    - name: Copy log4j-shell-poc
      ansible.builtin.copy:
        src: ./data/log4j-shell-poc/
        dest: /opt/log4j-shell-poc

    - name: Extract jdk-8u20-linux-x64.tar.gz
      ansible.builtin.unarchive:
        src: ./data/jdk-8u20-linux-x64.tar.gz
        dest: /opt/log4j-shell-poc
        
    - name: Install packages required for log4j-shell-poc
      ansible.builtin.shell:
        cmd: pip3 install -r requirements.txt
        chdir: /opt/log4j-shell-poc
